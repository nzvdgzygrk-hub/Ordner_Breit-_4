<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Etiketten 192 Ã— 61 mm</title>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;margin:16px}
button{padding:10px 16px;border:0;border-radius:6px;color:#fff;cursor:pointer}
.reset{background:#c9302c}
.pdf{background:#0275d8}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
.card{background:#fff;border:1px solid #ddd;border-radius:10px;padding:10px}
.preview{width:192mm;height:61mm;border:1px dashed #999;margin-bottom:6px}
canvas{width:192mm;height:61mm}
textarea,input{width:100%;margin-top:6px;padding:6px;border-radius:6px;border:1px solid #ccc}
textarea{white-space:pre}
</style>
</head>

<body>

<button class="reset" onclick="resetAll()">Reset</button>
<button class="pdf" onclick="makePDF()">PDF erstellen</button>

<div class="grid" id="grid"></div>

<script>
const LABELS=4;
const grid=document.getElementById("grid");

for(let i=1;i<=LABELS;i++){
  grid.innerHTML+=`
  <div class="card">
    <b>ETIKETT ${i}</b>
    <label style="float:right">Drucken <input id="p${i}" type="checkbox" checked></label>
    <div class="preview"><canvas id="c${i}" width="1152" height="366"></canvas></div>
    <textarea id="h${i}" placeholder="Ãœberschrift (max. 3 Zeilen, ENTER)" oninput="update(${i})"></textarea>
    <textarea id="t${i}" placeholder="Freitext" oninput="update(${i})"></textarea>
    <input id="n${i}" placeholder="Nummer unten" oninput="update(${i})">
  </div>`;
  update(i);
}

function resetAll(){
  for(let i=1;i<=LABELS;i++){
    ["h","t","n"].forEach(x=>document.getElementById(x+i).value="");
    document.getElementById("p"+i).checked=false;
    update(i);
  }
}

function update(i){
  const ctx=document.getElementById("c"+i).getContext("2d");
  drawLabel(ctx,
    document.getElementById("h"+i).value,
    document.getElementById("t"+i).value,
    document.getElementById("n"+i).value
  );
}

function drawLabel(ctx,header,text,number){
  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height);

  ctx.save();
  ctx.translate(0,ctx.canvas.height);
  ctx.rotate(-Math.PI/2);

  /* ðŸ”¥ WICHTIGER FIX ðŸ”¥ */
  ctx.fillStyle="#000";
  ctx.strokeStyle="#000";

  const W=ctx.canvas.height;
  const H=ctx.canvas.width;
  let y=10;

  ctx.font="bold 28px Arial";
  header.split("\n").slice(0,3).forEach(line=>{
    ctx.fillText(line,14,y);
    y+=32;
  });

  ctx.font="20px Arial";
  const lh=34;
  text.split("\n").forEach(line=>{
    ctx.fillText(line,14,y);
    ctx.beginPath();
    ctx.moveTo(8,y+lh-6);
    ctx.lineTo(W-8,y+lh-6);
    ctx.stroke();
    y+=lh;
  });

  if(number){
    ctx.font="bold 22px Arial";
    ctx.textAlign="center";
    ctx.fillText(number,W/2,H-26);
  }

  ctx.restore();
}

const mm=v=>v*2.83465;

async function makePDF(){
  const pdf=await PDFLib.PDFDocument.create();
  const page=pdf.addPage([595,842]);
  const left=(210-192)/2;
  const top=(297-4*61)/2;

  for(let i=1;i<=LABELS;i++){
    if(!document.getElementById("p"+i).checked) continue;
    const img=await pdf.embedPng(document.getElementById("c"+i).toDataURL());
    page.drawImage(img,{
      x:mm(left),
      y:842-mm(top+(i)*61),
      width:mm(192),
      height:mm(61)
    });
  }

  const blob=new Blob([await pdf.save()],{type:"application/pdf"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="etiketten_192x61.pdf";
  a.click();
}
</script>
</body>
</html>
